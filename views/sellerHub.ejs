<h2 class="text-2xl font-bold">Orders / Seller Hub</h2>

<button id="myBtn" style="width: 125px; height: 40px; background-color: rgb(156, 112, 70); border-radius:5px; border: 1px solid black; margin-top:10px;">Create new craft</button><br>
<button id="register-btn" style="width: 150px; height: 50px; background-color: rgb(197, 168, 168); border-radius:5px; border: 1px solid black; margin-top:10px;">Fill Your Details / Register</button>

<div class="grid md:grid-cols-2 gap-6 mt-4">

  <!-- Seller Registration -->
  <div class="bg-white p-4 rounded shadow" id="seller-registration-form">
    <h3 class="font-semibold">Register as Seller</h3>
    <% if (message) { %>
      <p class="text-green-600"><%= message %></p>
    <% } %>
    <form method="POST" action="/seller/create">
      <input name="name" placeholder="Name" required class="w-full border p-2 mt-2" />
      <input name="village" placeholder="Village" class="w-full border p-2 mt-2" />
      <input name="state" placeholder="State" class="w-full border p-2 mt-2" />
      <input name="pincode" placeholder="Pincode" class="w-full border p-2 mt-2" />
      <input name="phone" placeholder="Phone" class="w-full border p-2 mt-2" />
      <textarea name="bio" placeholder="Short bio" class="w-full border p-2 mt-2"></textarea>
      <button class="mt-2 px-4 py-2 bg-amber-700 text-white rounded">Register</button>
    </form>
  </div>

  <!-- Add Craft -->
  <div class="bg-white p-4 rounded shadow" id="new-craft-form">
    <h3 class="font-semibold">Add Craft</h3>
    <form method="POST" action="/marketplace/create" enctype="multipart/form-data">
      <input name="name" placeholder="Craft name" class="w-full border p-2 mt-2" />
      <input name="price" placeholder="Price" class="w-full border p-2 mt-2" />
      <input name="originState" placeholder="Origin state" class="w-full border p-2 mt-2" />
      <input name="sellerId" placeholder="Seller ID (from register)" value="<%= user._id %>" class="w-full border p-2 mt-2" />
      <input name="images" type="file" multiple class="w-full border p-2 mt-2" />
      <textarea name="description" placeholder="Description" class="w-full border p-2 mt-2"></textarea>
      <button class="mt-2 px-4 py-2 bg-amber-700 text-white rounded">Add Craft</button>
    </form>
  </div>
</div>

<!-- Orders grouped by craft -->
<section class="mt-10">
  <h3 class="text-xl font-semibold mb-4">Orders by Craft</h3>

  <% if (ordersByCraft && ordersByCraft.length > 0) { %>
    <% ordersByCraft.forEach(({ craft, orders }) => { %>
      <div class="mb-8 p-4 border rounded shadow bg-white">
        <h4 class="font-semibold text-lg mb-3"><%= craft.name %></h4>
        <% if (orders.length === 0) { %>
          <p class="italic text-gray-500">No pending orders for this craft.</p>
        <% } else { %>
          <table class="w-full text-left border-collapse">
            <thead>
              <tr>
                <th class="border px-2 py-1">Order ID</th>
                <th class="border px-2 py-1">Buyer</th>
                <th class="border px-2 py-1">Quantity</th>
                <th class="border px-2 py-1">Total Price</th>
                <th class="border px-2 py-1">Status</th>
                <th class="border px-2 py-1">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% orders.forEach(order => { %>
                <tr>
                  <td class="border px-2 py-1"><%= order._id %></td>
                  <td class="border px-2 py-1"><%= order.buyer.username %></td>
                  <td class="border px-2 py-1"><%= order.quantity %></td>
                  <td class="border px-2 py-1">₹<%= order.craft.price * order.quantity %></td>
                  <td class="border px-2 py-1"><%= order.status %></td>
                  <td class="border px-2 py-1">
                    <% if(order.status !== 'Delivered') { %>
                      <form method="POST" action="/seller/orders/<%= order._id %>/dispatch" style="display:inline;">
                        <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Dispatch</button>
                      </form>
                    <% } else { %>
                      <span class="text-green-700 font-semibold">Completed</span>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    <% }) %>
  <% } else { %>
    <p class="italic text-gray-500">No crafts or orders found.</p>
  <% } %>
</section>

<!-- All orders flat list -->
<section class="mt-10">
  <h3 class="text-xl font-semibold mb-4">All Orders</h3>
  
  <% if ((!pendingOrders || pendingOrders.length === 0) && (!completedOrders || completedOrders.length === 0)) { %>
    <p class="italic text-gray-500">No orders found.</p>
  <% } else { %>
    <table class="w-full text-left border-collapse bg-white rounded shadow">
      <thead>
        <tr>
          <th class="border px-2 py-1">Order ID</th>
          <th class="border px-2 py-1">Craft</th>
          <th class="border px-2 py-1">Buyer</th>
          <th class="border px-2 py-1">Quantity</th>
          <th class="border px-2 py-1">Total Price</th>
          <th class="border px-2 py-1">Status</th>
          <th class="border px-2 py-1">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% pendingOrders.forEach(order => { %>
          <tr>
            <td class="border px-2 py-1"><%= order._id %></td>
            <td class="border px-2 py-1"><%= order.craft.name %></td>
            <td class="border px-2 py-1"><%= order.buyer.username %></td>
            <td class="border px-2 py-1"><%= order.quantity %></td>
            <td class="border px-2 py-1">₹<%= order.craft.price * order.quantity %></td>
            <td class="border px-2 py-1"><%= order.status %></td>
            <td class="border px-2 py-1">
              <form method="POST" action="/seller/orders/<%= order._id %>/dispatch" style="display:inline;">
                <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Dispatch</button>
              </form>
            </td>
          </tr>
        <% }) %>

        <% completedOrders.forEach(order => { %>
          <tr class="bg-green-50">
            <td class="border px-2 py-1"><%= order._id %></td>
            <td class="border px-2 py-1"><%= order.craft.name %></td>
            <td class="border px-2 py-1"><%= order.buyer.username %></td>
            <td class="border px-2 py-1"><%= order.quantity %></td>
            <td class="border px-2 py-1">₹<%= order.craft.price * order.quantity %></td>
            <td class="border px-2 py-1 text-green-700 font-semibold"><%= order.status %></td>
            <td class="border px-2 py-1">—</td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</section>
